<?xml version="1.0" encoding="utf-8"?>
<androidx.core.widget.NestedScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/backgroundLight">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        tools:context=".ui.admin.AdminPatientDetailActivity">

        <!-- Header -->
        <RelativeLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:padding="16dp">
            <!-- ... ImageButton Back và Title ... -->
            <ImageButton
                android:id="@+id/btnBack"
                android:layout_width="48dp"
                android:layout_height="48dp"
                android:src="@drawable/ic_back"
                android:background="?attr/selectableItemBackgroundBorderless"
                android:contentDescription="Quay lại"
                android:layout_centerVertical="true"
                android:layout_alignParentStart="true"
                app:tint="@color/textPrimary" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_centerInParent="true"
                android:text="Chi Tiết Bệnh Nhân"
                android:textColor="@color/textPrimary"
                android:textSize="22sp"
                android:textStyle="bold" />
        </RelativeLayout>

        <!-- Thông tin cơ bản -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:paddingHorizontal="16dp"
            android:paddingBottom="16dp">
            <!-- ... Các TextView cho Tên, Mã, Email, SĐT, Giới tính ... -->
            <TextView
                android:id="@+id/tvPatientName"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:textSize="24sp"
                android:textStyle="bold"
                android:textColor="@color/colorPrimaryDark"
                tools:text="Tên Bệnh Nhân" />
            <TextView
                android:id="@+id/tvPatientCode"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:textSize="16sp"
                android:textColor="@color/textSecondary"
                tools:text="Mã bệnh nhân: P12345678" />

            <TextView
                android:id="@+id/tvPatientEmail"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:textSize="16sp"
                android:textColor="@color/textSecondary"
                tools:text="patient@example.com" />

            <TextView
                android:id="@+id/tvPatientPhone"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="16sp"
                android:textColor="@color/textSecondary"
                tools:text="SĐT: 0987654321" />

            <TextView
                android:id="@+id/tvPatientGender"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="16sp"
                android:textColor="@color/textSecondary"
                tools:text="Giới tính: Nam" />
        </LinearLayout>

        <!-- Thẻ thống kê -->
        <androidx.cardview.widget.CardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginHorizontal="16dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="4dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView style="@style/DetailSectionTitle" android:text="Tổng Quan" />
                <TextView android:id="@+id/tvTotalSpending" style="@style/DetailItem" tools:text="Tổng chi tiêu: 5,000,000 đ" />
                <TextView android:id="@+id/tvTotalAppointments" style="@style/DetailItem" tools:text="Tổng số lịch hẹn: 15" />
                <TextView android:id="@+id/tvLastCheckIn" style="@style/DetailItem" tools:text="Lần khám gần nhất: 20/10/2025" />
            </LinearLayout>
        </androidx.cardview.widget.CardView>

        <!-- Thẻ lần khám gần nhất -->
        <androidx.cardview.widget.CardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginHorizontal="16dp"
            android:layout_marginTop="16dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="4dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView style="@style/DetailSectionTitle" android:text="Lần Khám Gần Nhất" />

                <!-- Dòng này chỉ hiển thị khi không có dữ liệu -->
                <TextView android:id="@+id/tvNoLastExam" style="@style/DetailItem" android:text="Chưa có dữ liệu khám bệnh." android:visibility="gone" />

                <!-- Nhóm các TextView hiển thị thông tin -->
                <LinearLayout
                    android:id="@+id/layoutLastExamDetails"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:visibility="visible">

                    <TextView android:id="@+id/tvLastExamDate" style="@style/DetailItem" tools:text="Ngày khám: 20/10/2025" />
                    <TextView android:id="@+id/tvLastExamCode" style="@style/DetailItem" tools:text="Mã phiếu khám: PK12345" />

                    <!-- Các chỉ số sinh tồn -->
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="12dp"
                        android:text="Chỉ số sinh tồn:"
                        android:textColor="@color/textPrimary"
                        android:textStyle="bold"/>
                    <TextView android:id="@+id/tvLastExamHeightWeight" style="@style/DetailItem" tools:text="Chiều cao / Cân nặng: 170 cm / 65 kg" />
                    <TextView android:id="@+id/tvLastExamBloodPressure" style="@style/DetailItem" tools:text="Huyết áp: 120/80 mmHg" />
                    <TextView android:id="@+id/tvLastExamPulse" style="@style/DetailItem" tools:text="Mạch: 75 bpm" />

                    <!-- Chẩn đoán và tiền sử bệnh -->
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="12dp"
                        android:text="Thông tin khám:"
                        android:textColor="@color/textPrimary"
                        android:textStyle="bold"/>
                    <TextView android:id="@+id/tvLastExamMedicalHistory" style="@style/DetailItem" tools:text="Tiền sử bệnh: Tăng huyết áp" />
                    <TextView android:id="@+id/tvLastExamDiagnosis" style="@style/DetailItem" tools:text="Chẩn đoán: Viêm họng cấp" />

                    <TextView
                        android:id="@+id/tvLastExamTotal"
                        style="@style/DetailItem"
                        android:layout_marginTop="12dp"
                        android:textStyle="bold"
                        android:textColor="@color/colorPrimaryDark"
                        tools:text="Tổng chi phí: 350,000 đ" />

                </LinearLayout>
            </LinearLayout>
        </androidx.cardview.widget.CardView>

        <!-- Thẻ đánh giá -->
        <androidx.cardview.widget.CardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginHorizontal="16dp"
            android:layout_marginTop="16dp"
            android:layout_marginBottom="16dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="4dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView style="@style/DetailSectionTitle" android:text="Các Đánh Giá" />
                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/recyclerPatientReviews"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:nestedScrollingEnabled="false"
                    tools:itemCount="3"
                    tools:listitem="@layout/admin_item_patient_review"/>
                <TextView android:id="@+id/tvNoReviews" style="@style/DetailItem" android:text="Bệnh nhân chưa có đánh giá nào." android:visibility="gone" />

            </LinearLayout>
        </androidx.cardview.widget.CardView>
    </LinearLayout>
</androidx.core.widget.NestedScrollView>
